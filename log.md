# MedTator React é‡æ„ - å¼€å‘æ—¥å¿—

### 2026-02-11 - Session 1.1 é¡¹ç›®å¯åŠ¨ä¸æ¶æ„è®¾è®¡

**ä¸Šåˆ - ç¯å¢ƒæ­å»º**ï¼š
- âœ… Fork åŸé¡¹ç›®åˆ°ä¸ªäººä»“åº“
- âœ… åˆ›å»º jay-dev å¼€å‘åˆ†æ”¯
- âœ… æ­å»º Python è™šæ‹Ÿç¯å¢ƒ
- âœ… åŸç‰ˆåº”ç”¨æˆåŠŸè¿è¡Œï¼ˆFlask http://localhost:8086ï¼‰
- âœ… åˆ›å»ºå·¥ä½œæ–‡æ¡£ work.mdï¼ˆåæ”¹åä¸º reload.mdï¼‰

**ä¸‹åˆ - ä»£ç åˆ†æ**ï¼š
- ğŸ“Š ä»£ç é‡ç»Ÿè®¡ï¼š35ä¸ªJSæ–‡ä»¶ (18807è¡Œ) + 23ä¸ªHTMLæ¨¡æ¿ (11031è¡Œ)
- ğŸ“Š æ ¸å¿ƒæ–‡ä»¶ï¼šapp_hotpot.js (3795è¡Œ) + 13ä¸ªæ‰©å±•æ¨¡å— (~6500è¡Œ)
- ğŸ“Š è§£æå™¨ï¼šann(1085è¡Œ) + dtd(1092è¡Œ) + brat(560è¡Œ) + bioc(229è¡Œ)
- ğŸ—ï¸ æ¶æ„åˆ†æï¼šå•é¡µåº”ç”¨ï¼ˆ7ä¸ªTabï¼‰ã€å·¨å‹Vueå®ä¾‹ã€File System Access API
- ğŸ¯ ç¡®å®šé‡æ„ç­–ç•¥ï¼šbratå°è£…è€Œéé‡å†™ï¼ŒåŸç‰ˆä»£ç ä¿æŒä¸åŠ¨

**æ™šä¸Š - Reacté¡¹ç›®åˆå§‹åŒ–**ï¼š
- âœ… ä½¿ç”¨Viteåˆ›å»ºReact 18 + TypeScripté¡¹ç›®
- âœ… å®‰è£…176ä¸ªä¾èµ–åŒ…
- âœ… éªŒè¯å¼€å‘æœåŠ¡å™¨è¿è¡Œï¼ˆhttp://localhost:5173ï¼‰
- âœ… Gitæäº¤ï¼š"vite init" (e9c5464)
- ğŸ—ï¸ å®ŒæˆReactæ¶æ„è®¾è®¡æ–‡æ¡£
- ğŸ”§ ä¿®æ­£é‡æ„è®¡åˆ’ï¼šè§£æå™¨æå‰åˆ° M3ï¼Œæ ‡æ³¨ç¼–è¾‘å™¨è°ƒæ•´ä¸º 15å¤©ï¼Œæ€»å‘¨æœŸ 18å‘¨

**æŠ€æœ¯å†³ç­–**ï¼š
- ç›®å½•ç»“æ„ï¼šä¿æŒæ ¹ç›®å½•ä¸å˜ + æ–°å»ºMedTator-React/
- çŠ¶æ€ç®¡ç†ï¼šZustandï¼ˆä¸€ä¸ªstore.tsæå®šï¼‰
- Tabåˆ‡æ¢ï¼šä¸ç”¨è·¯ç”±ï¼Œstateæ¡ä»¶æ¸²æŸ“
- UIæ¡†æ¶ï¼šAnt Designæ›¿ä»£Metro UI
- æ¡Œé¢æ‰“åŒ…ï¼šElectronï¼ˆæ›¿ä»£æµè§ˆå™¨File System Access APIï¼‰

### Session 1.2 - æ¶æ„ç®€åŒ–

- ğŸ”§ ç æ‰è¿‡åº¦è®¾è®¡ï¼šReact Routerã€ESLint/Prettierã€æµ‹è¯•ã€å¤šsliceçŠ¶æ€ç®¡ç†
- ğŸ”§ æ¨¡å—ä»15ä¸ªç²¾ç®€ä¸º8ä¸ªï¼Œå‘¨æœŸä»18å‘¨å‹ç¼©åˆ°8å‘¨
- ğŸ”§ åŠ å…¥Electronæ¡Œé¢æ‰“åŒ…æ–¹æ¡ˆ
- ğŸ”§ ç›®å½•ç»“æ„æ”¹ä¸ºæ‰å¹³ï¼ˆcomponents/ä¸‹ç›´æ¥æ”¾ç»„ä»¶ï¼‰

### Session 1.3 - åŸç‰ˆæ·±åº¦åˆ†æ + M1æ”¶å°¾

**æ–°å‘ç°**ï¼š
- Flask æœåŠ¡å™¨å‡ ä¹æ— ç”¨ï¼Œåªserveé™æ€é¡µé¢ + æ³¨å…¥sampleæ•°æ®ï¼Œæ— åç«¯API
- vpp_data å…¨å±€çŠ¶æ€å«30+å±æ€§ï¼Œéœ€è¦å®Œæ•´æ¬åˆ°store.ts
- 7ä¸ªTabå„å¯¹åº”ä¸€ä¸ªextæ¨¡å—ï¼Œè¡Œæ•°å·®å¼‚å¤§ï¼ˆ75è¡Œ~1314è¡Œï¼‰
- 4ä¸ªparseræ˜¯çº¯å‡½æ•°æ— DOMä¾èµ–ï¼Œæœ€é€‚åˆå…ˆç§»æ¤
- Electroné›†æˆæ¨è¿Ÿåˆ°M7ï¼Œå…ˆç”¨æµè§ˆå™¨file inputåšæ–‡ä»¶æ“ä½œ

**å†³ç­–è°ƒæ•´**ï¼š
- M1çš„Electroné›†æˆæ¨è¿Ÿ â†’ å…ˆåšæ ¸å¿ƒåŠŸèƒ½ï¼Œæœ€åæ‰“åŒ…
- M3æ–‡ä»¶æ“ä½œå…ˆç”¨æµè§ˆå™¨æ–¹æ¡ˆï¼ˆinput+drag&dropï¼‰ï¼Œä¸ä¾èµ–Electron
- ä¿®å¤äº†RibbonMenuçš„TabKeyç±»å‹å¯¼å…¥é—®é¢˜ï¼ˆimport typeï¼‰

### 2026-02-11 - Session 2.1 M2è§£æå™¨ç§»æ¤

**M2-è§£æå™¨ç§»æ¤ï¼ˆ4ä¸ªparser â†’ TypeScriptï¼Œ2966è¡Œï¼‰**ï¼š
- âœ… æ–°å»º `types.ts`ï¼šå…±äº«ç±»å‹å®šä¹‰ï¼ˆDtd, DtdTag, Ann, AnnTag, BratDocDataç­‰ï¼‰
- âœ… `parsers/dtd-parser.ts` â† dtd_parser.js (1092è¡Œ)ï¼šSchemaè§£æï¼ˆDTD/JSON/YAMLï¼‰
- âœ… `parsers/ann-parser.ts` â† ann_parser.js (1085è¡Œ)ï¼šæ ‡æ³¨XMLè§£æ/spanå·¥å…·/hintå­—å…¸
- âœ… `parsers/brat-parser.ts` â† brat_parser.js (560è¡Œ)ï¼šBRATæ ¼å¼è½¬æ¢+é¢œè‰²ç®¡ç†
- âœ… `parsers/bioc-parser.ts` â† bioc_parser.js (229è¡Œ)ï¼šBioC XMLç”Ÿæˆ/å¯¼å‡º
- âœ… å®‰è£…ä¾èµ–ï¼šjs-yaml + @types/js-yaml
- âœ… TypeScriptç¼–è¯‘é›¶é”™è¯¯

**Annotation Tab å¸ƒå±€å¯¹é½**ï¼š
- ğŸ“ å·¥å…·æ Ribbonï¼š8ä¸ªåˆ†ç»„ï¼ˆSchema/File/Display/Search/Entity/Link/Hint/Helpï¼‰
- ğŸ“ ä¸ŠåŠåŒº(60%)ï¼šæ–‡ä»¶åˆ—è¡¨é¢æ¿(250px) + CodeMirrorç¼–è¾‘å™¨å ä½
- ğŸ“ ä¸‹åŠåŒº(40%)ï¼šTagå®šä¹‰åˆ—è¡¨ + æ ‡æ³¨è¡¨æ ¼
- ğŸ¯ çº¯å¸ƒå±€éª¨æ¶ï¼ŒåŠŸèƒ½åç»­æ¥å…¥

**å•å…ƒæµ‹è¯•ï¼ˆVitest + jsdomï¼‰**ï¼š
- âœ… 67ä¸ªæµ‹è¯•å…¨éƒ¨é€šè¿‡ï¼š
  - dtd-parser.test.ts (17ä¸ª)ï¼šDTD/JSON/YAMLè§£æã€roundtripã€è¾¹ç•Œæƒ…å†µ
  - ann-parser.test.ts (30ä¸ª)ï¼šspanå·¥å…·ã€xml2annã€tagå·¥å…·ã€hintå­—å…¸
  - brat-parser.test.ts (14ä¸ª)ï¼šé¢œè‰²ç®¡ç†ã€parseAnnã€collection/documentæ•°æ®
  - bioc-parser.test.ts (6ä¸ª)ï¼šBioC XMLç”Ÿæˆã€entity/relation/å¤šæ–‡æ¡£
- âœ… ç”¨sample/çœŸå®æ•°æ®éªŒè¯é€šè¿‡
- ğŸ”§ vite.config.ts é…ç½® jsdom ç¯å¢ƒ
- ğŸ”§ package.json æ·»åŠ  `npm test` / `npm run test:watch`

**ä»£ç å®¡æŸ¥ä¿®å¤ï¼ˆé€å‡½æ•°å¯¹ç…§åŸç‰ˆï¼Œ9ä¸ªé—®é¢˜ï¼‰**ï¼š
- ğŸ› dtd-parser: `NON_CONSUMING_SPANS` æœªå¯¼å‡º â†’ åŠ export
- ğŸ› dtd-parser: `getAttrRequire()` åªå–é¦–ä¸ªåŒ¹é… â†’ æ”¹ä¸ºå–æœ€åä¸€ä¸ªï¼ˆå¾ªç¯ï¼‰
- ğŸ› dtd-parser: `parseTmpDtd()` ç”¨truthinessæ£€æŸ¥ â†’ æ”¹ç”¨hasOwnProperty
- ğŸ› ann-parser: `ann2xml` ç©ºmetaä¹Ÿç”Ÿæˆæ ‡ç­¾ â†’ åŠ é•¿åº¦å®ˆå«
- ğŸ› brat-parser: ç¼º `ann2brat()` å‡½æ•° â†’ è¡¥stubï¼ˆåŸç‰ˆä¹Ÿæœªå®Œæˆï¼‰
- ğŸ› brat-parser: `medtagger2brat` å¤šä½™certaintyå®ˆå« â†’ å»æ‰
- ğŸ› brat-parser: emojiè¢«æ¢æˆASCII â†’ æ¢å¤ â•â–â“
- ğŸ› brat-parser: `getColor` ç”¨falsyæ£€æŸ¥ â†’ æ”¹ç”¨hasOwnProperty
- ğŸ¯ æ”¹è¿›ä¿ç•™ï¼š`mkBaseTag` id_prefix bugä¿®å¤ã€nullå®ˆå«ã€`.contains()â†’.includes()`

**å·²çŸ¥é—ç•™**ï¼š
- â¸ `ann-parser` ç¼º `get_subtags_of_substr_in_ann`ï¼ˆM4å®ç°ï¼Œéœ€nlp_toolkitï¼‰
- â¸ `ann-parser` ç¼º `pretty_xml_str`ï¼ˆä¾èµ–jQueryï¼Œæ— è°ƒç”¨è€…ï¼‰

### 2026-02-12 - Session 3.1 M3 Step 1: store.ts çŠ¶æ€è®¾è®¡

**åŸç‰ˆçŠ¶æ€å…¨é‡æ¢³ç†**ï¼š
- ğŸ“Š æ‰«æ app_hotpot.js çš„ vpp_dataï¼ˆ30è¡Œ~175è¡Œï¼‰+ 11ä¸ªextæ¨¡å—
- ğŸ“Š ç»Ÿè®¡å‡ºåŸç‰ˆå…± 96+ ä¸ªçŠ¶æ€å±æ€§
- ğŸ¯ ç­›é€‰å‡º M3 éœ€è¦çš„ 16 ä¸ªå±æ€§ + 14 ä¸ª actions

**é‡å†™ store.tsï¼ˆ40è¡Œ â†’ 169è¡Œï¼‰**ï¼š
- âœ… ç”¨ `types.ts` çš„çœŸå®ç±»å‹ï¼ˆ`Dtd`, `Ann`ï¼‰æ›¿ä»£ `any`
- âœ… æ–°å¢å¯¼å‡ºç±»å‹ï¼š`SortAnnsBy`ï¼ˆ6ç§æ’åºï¼‰ã€`CmSettings`ï¼ˆ7ä¸ªç¼–è¾‘å™¨é€‰é¡¹ï¼‰
- âœ… çŠ¶æ€åˆ†7ç»„ï¼šTab / Schema / æ ‡æ³¨æ–‡ä»¶ / æ–‡ä»¶åˆ—è¡¨ / Tagè¿‡æ»¤ / åŠ è½½è¿›åº¦ / CMè®¾ç½®
- âœ… TypeScriptç¼–è¯‘é›¶é”™è¯¯ï¼Œ67ä¸ªè§£æå™¨æµ‹è¯•å…¨éƒ¨é€šè¿‡

**å…³é”®è®¾è®¡å†³ç­–**ï¼š
- ğŸ¯ `setAnns` è‡ªåŠ¨é‡ç½® `annIdx=0` + `pgIndex=0`
- ğŸ¯ `addAnns` å¢é‡è¿½åŠ ä¸è¦†ç›–ï¼ˆé€‚é…å¼‚æ­¥æ‰¹é‡åŠ è½½ï¼‰
- ğŸ¯ `removeAnn` è‡ªåŠ¨ä¿®æ­£ `annIdx`ï¼ˆåˆ é™¤åä¸è¶Šç•Œï¼‰
- ğŸ¯ æ’åº/è¿‡æ»¤å˜æ›´æ—¶è‡ªåŠ¨ `pgIndex=0`
- ğŸ¯ Loading ä¸‰é˜¶æ®µï¼š`start` â†’ `update` â†’ `finish`
- â¸ æœªæ¥æ¨¡å—çŠ¶æ€ï¼ˆhintsã€linkingã€IAAã€razerç­‰ï¼‰ç­‰åˆ°å¯¹åº”æ¨¡å—æ—¶å†åŠ 

**çŠ¶æ€æ¥å£**ï¼š
```typescript
interface AppState {
  // Tab
  currentTab: TabKey
  // Schema
  dtd: Dtd | null
  // æ ‡æ³¨æ–‡ä»¶
  anns: Ann[]
  annIdx: number | null
  // æ–‡ä»¶åˆ—è¡¨
  sortAnnsBy: SortAnnsBy
  fnPattern: string
  pgIndex: number
  pgNumPerPage: number
  // Tagè¿‡æ»¤
  displayTagName: string
  // åŠ è½½è¿›åº¦
  isLoadingAnns: boolean
  nAnnsDropped/Loaded/Error: number
  msgLoadingAnns: string
  // CMè®¾ç½®
  cm: CmSettings
}
```

**ä¸‹ä¸€æ­¥**ï¼šM3 Step 2 - æ–‡ä»¶æ“ä½œï¼ˆfile-helper + æ‹–æ‹½ + parseræ¥å…¥ + UIæ›´æ–°ï¼‰

### 2026-02-12 - Session 3.2 M3 Step 2: æ–‡ä»¶æ“ä½œ

**æ ¸å¿ƒåŠŸèƒ½å®ç°**ï¼š
- âœ… åˆ›å»º `utils/file-helper.ts` (75è¡Œ)ï¼šæ–‡ä»¶è¯»å–ã€ç±»å‹æ£€æŸ¥ã€ä¸‹è½½å·¥å…·
- âœ… é‡å†™ `Annotation.tsx` (305è¡Œ â†’ 500+è¡Œ)ï¼š
  - Schema åŠ è½½ï¼šæ‹–æ‹½ + æ–‡ä»¶é€‰æ‹©å™¨ï¼Œæ”¯æŒ .dtd/.json/.yaml
  - Annotation åŠ è½½ï¼šæ‰¹é‡åŠ è½½ .xml/.txtï¼Œæ˜¾ç¤º loading è¿›åº¦
  - æ–‡ä»¶åˆ—è¡¨ï¼šæ˜¾ç¤ºã€æ’åº(6ç§)ã€è¿‡æ»¤ã€åˆ†é¡µ(100/é¡µ)ã€ç‚¹å‡»åˆ‡æ¢
  - ç¼–è¾‘å™¨ï¼šæ˜¾ç¤ºå½“å‰æ–‡ä»¶æ–‡æœ¬ï¼ˆæš‚ç”¨ textarea å ä½ï¼‰
  - Tag åˆ—è¡¨ï¼šæ˜¾ç¤º DTD çš„ Entity/Relation Tagsï¼Œæ”¯æŒç‚¹å‡»è¿‡æ»¤
  - æ ‡æ³¨è¡¨æ ¼ï¼šæ˜¾ç¤ºå½“å‰æ–‡ä»¶æ ‡æ³¨(Tag/ID/Spans/Text/Attributes)ï¼Œæ”¯æŒ Tag è¿‡æ»¤
- âœ… æ•°æ®æµæ‰“é€šï¼šæ–‡ä»¶æ‹–æ‹½ â†’ Parserè§£æ â†’ Storeæ›´æ–° â†’ UIè‡ªåŠ¨åˆ·æ–°
- âœ… é”™è¯¯å¤„ç†ï¼šæ–‡ä»¶ç±»å‹æ£€æŸ¥ã€è§£æå¤±è´¥æç¤ºã€é”™è¯¯è®¡æ•°

**æµ‹è¯•éªŒè¯**ï¼š
- âœ… ç”Ÿæˆæµ‹è¯•æ–‡ä»¶ï¼š`test-schema.dtd` (3 Entity + 2 Relation) + `test-annotation.xml` (7 ä¸ªæ ‡æ³¨)
- âœ… åŠŸèƒ½æ‰‹åŠ¨æµ‹è¯•ï¼šSchema åŠ è½½ã€Annotation åŠ è½½ã€Tag è¿‡æ»¤ã€æ–‡ä»¶åˆ‡æ¢ - å…¨éƒ¨æ­£å¸¸
- âœ… TypeScript ç¼–è¯‘é›¶é”™è¯¯
- âœ… 67 ä¸ª parser æµ‹è¯•å…¨éƒ¨é€šè¿‡

**ä¿®å¤é—®é¢˜**ï¼š
- ğŸ› æ¸…ç†æœªä½¿ç”¨ importsï¼ˆAnnotation.tsxã€æµ‹è¯•æ–‡ä»¶ï¼‰
- ğŸ› `ann-parser.ts` å‚æ•°é‡å‘½åï¼ˆ`dtd` â†’ `_dtd`ï¼‰

**æŠ€æœ¯å†³ç­–**ï¼š
- ğŸ¯ æš‚æ—¶ä¸ç”¨ CodeMirrorï¼ˆM4 å†é›†æˆæ ‡æ³¨åŠŸèƒ½ï¼‰
- ğŸ¯ Tags/Tags_r/Label æ’åºæœªå®ç°ï¼ˆæ ‡è®° TODOï¼‰
- ğŸ¯ ä½¿ç”¨ useMemo ä¼˜åŒ–åˆ—è¡¨è¿‡æ»¤/æ’åº

**è¿›åº¦**ï¼šM3 å®Œæˆ 2.5/3 æ­¥éª¤ï¼ˆ83%ï¼‰

**ä¸‹ä¸€æ­¥é€‰æ‹©**ï¼š
- é€‰é¡¹ 1: M3 Step 3 - ZIP æ‰“åŒ…åŠŸèƒ½
- é€‰é¡¹ 2: è·³åˆ° M4 - æ ‡æ³¨ç¼–è¾‘å™¨ï¼ˆCodeMirror + å®ä½“/å…³ç³»æ ‡æ³¨ï¼‰

### 2026-02-12 - Session 3.3 å†³ç­–ï¼šè·³è¿‡ M3 Step 3

**å†³å®š**ï¼šè·³è¿‡ ZIP æ‰“åŒ…åŠŸèƒ½ï¼Œç›´æ¥è¿›å…¥ M4 æ ‡æ³¨ç¼–è¾‘å™¨

**åŸå› **ï¼š
- M4 æ˜¯æ ¸å¿ƒåŠŸèƒ½ï¼ˆ12 å¤©ï¼‰ï¼Œä¼˜å…ˆçº§æ›´é«˜
- å¤šæ–‡ä»¶é€‰æ‹©å·²è¶³å¤Ÿä½¿ç”¨
- ZIP åŠŸèƒ½å¯åç»­è¡¥å……ï¼ˆéé˜»å¡ï¼‰

**M3 æœ€ç»ˆçŠ¶æ€**ï¼šæ ¸å¿ƒåŠŸèƒ½ 100% å®Œæˆï¼ˆStep 3 å»¶åï¼‰

**ä¸‹ä¸€æ­¥**ï¼šM4 æ ‡æ³¨ç¼–è¾‘å™¨ - CodeMirror é›†æˆ + å®ä½“/å…³ç³»æ ‡æ³¨ + BRAT å¯è§†åŒ–

### 2026-02-12 - Session 4.1 M4 Phase 1: Store æ‰©å±• + Tag Helper

**æäº¤**: 8abb46aï¼ˆSonnet 4.5ï¼‰

- âœ… æ–°å»º `utils/tag-helper.ts` (98è¡Œ)ï¼šmakeEtagã€makeEmptyEtagByDefã€makeEmptyRtagByDefã€getIdrefAttrs
- âœ… æ‰©å±• `store.ts` (169â†’298è¡Œ)ï¼štagå¢åˆ æ”¹ + selectedTagId + å…³ç³»é“¾æ¥çŠ¶æ€æœº
- âœ… æ–°å»º `utils/__tests__/tag-helper.test.ts` (8ä¸ªæµ‹è¯•)
- âœ… 75ä¸ªæµ‹è¯•å…¨éƒ¨é€šè¿‡

### 2026-02-13 - Session 4.2 M4 Phase 2: CodeMirror 6 æ ¸å¿ƒé›†æˆ

**çŠ¶æ€**: ä»£ç å®Œæˆï¼Œå¾…æäº¤ï¼ˆOpus 4.6ï¼‰

**æ–°å¢ 4 ä¸ª editor æ¨¡å—**ï¼š
- âœ… `editor/cm-spans.ts` (~40è¡Œ)ï¼šspans â†” CM6ä½ç½® è½¬æ¢
- âœ… `editor/cm-decorations.ts` (~150è¡Œ)ï¼šä¸¤å±‚ StateField è£…é¥°ï¼ˆæ ‡æ³¨é«˜äº® + é€‰ä¸­é«˜äº®ï¼‰
- âœ… `editor/cm-theme.ts` (~165è¡Œ)ï¼šCM6 theme + 24è‰²è°ƒè‰²æ¿ + åŠ¨æ€ CSS æ³¨å…¥
- âœ… `editor/cm-setup.ts` (~23è¡Œ)ï¼šCM6 Extension æ•°ç»„

**æ–°å¢ç»„ä»¶**ï¼š
- âœ… `components/AnnotationEditor.tsx` (~145è¡Œ)ï¼šCM6 React å°è£…ï¼Œæ›¿æ¢æ—§ textarea

**ä¿®æ”¹**ï¼š
- âœ… `Annotation.tsx`ï¼šåˆ é™¤ EditorPanelï¼Œé›†æˆ AnnotationEditorï¼Œå·¥å…·æ ç»‘å®š store
- âœ… `test-annotation.xml`ï¼šä¿®å¤ spans off-by-one åç§»

**ä¿®å¤6ä¸ªé—®é¢˜**ï¼š
- ğŸ› æ ‡æ³¨é»‘è‰² â†’ æ–°å¢ assignTagColors() è°ƒè‰²æ¿åˆ†é…
- ğŸ› æ ‡æ³¨å·¦åä¸€å­—ç¬¦ â†’ ä¿®æ­£ test-annotation.xml spans
- ğŸ› DecorationSet TS1484 â†’ type-only import
- ğŸ› é—æ¼ Color+ID æ¨¡å¼ â†’ CSS ::before + wrapper class
- ğŸ› Tagåˆ—è¡¨é¢œè‰²é»‘è‰² â†’ assignTagColors åœ¨ setDtd ä¹‹å‰è°ƒç”¨
- ğŸ› å·¥å…·æ æœªç»‘å®š â†’ Radio.Group/Switch æ¥å…¥ setCm()

**éªŒè¯**ï¼šç¼–è¯‘é›¶é”™è¯¯ï¼Œ75æµ‹è¯•é€šè¿‡ï¼Œæµè§ˆå™¨æ ‡æ³¨é«˜äº®æ­£å¸¸

**ä¸‹ä¸€æ­¥**ï¼šPhase 3 å³é”®èœå• + å®ä½“åˆ›å»ºï¼ˆæ¨è Sonnetï¼‰

### 2026-02-13 - Session 4.3 M4 Phase 3: å³é”®èœå• + å®ä½“åˆ›å»º

**çŠ¶æ€**: ä»£ç å®Œæˆï¼Œå¾…æäº¤ï¼ˆSonnet 4.5ï¼‰

**æ–°å¢ç»„ä»¶**ï¼š
- âœ… `ContextMenu.tsx` (156è¡Œ)ï¼šReact Portal æµ®å±‚ï¼Œæ˜¾ç¤º Entity Tags åˆ—è¡¨

**ä¿®æ”¹**ï¼š
- âœ… `AnnotationEditor.tsx`ï¼šé›†æˆ contextmenu/mousedown äº‹ä»¶ï¼ŒhandleTagSelect é€»è¾‘
- âœ… `Annotation.tsx`ï¼šAnnotationTable æ·»åŠ è‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨

**æ•°æ®æµ**ï¼š
```
é€‰ä¸­æ–‡æœ¬ â†’ å³é”® â†’ ContextMenu â†’ ç‚¹å‡» tag
  â†“
cmRangeToSpans â†’ makeEtag â†’ store.addTag
  â†“
useEffect è§¦å‘ â†’ CM6 å½©è‰²é«˜äº® + è¡¨æ ¼æ»šåŠ¨åˆ°åº•éƒ¨
```

**åŠŸèƒ½å¯¹ç…§**ï¼šæ ¸å¿ƒåŠŸèƒ½ 100% å®Œæˆ
- âœ… å³é”®èœå•ï¼ˆé¢œè‰² + å¿«æ·é”®ï¼‰ã€åˆ›å»ºæ ‡æ³¨ã€æ¸…é™¤é€‰æ‹©ã€å…³é—­èœå•
- âœ… æ»šåŠ¨è¡¨æ ¼åˆ°åº•éƒ¨ã€ç‚¹å‡»æ ‡æ³¨é«˜äº®
- â¸ï¸ å¿«æ·é”®åˆ›å»ºï¼ˆå»¶ååˆ° Phase 7ï¼‰

**éªŒè¯**ï¼šç¼–è¯‘é›¶é”™è¯¯ï¼Œ75æµ‹è¯•é€šè¿‡ï¼Œæµè§ˆå™¨åŠŸèƒ½æ­£å¸¸

**ä¸‹ä¸€æ­¥**ï¼šPhase 4 æ ‡æ³¨è¡¨æ ¼äº¤äº’å¢å¼ºï¼ˆæ¨è Sonnetï¼‰

### 2026-02-13 - Session 4.4 M4 Phase 4: æ ‡æ³¨è¡¨æ ¼äº¤äº’å¢å¼º

**çŠ¶æ€**: ä»£ç å®Œæˆï¼Œå¾…æäº¤ï¼ˆSonnet 4.5ï¼‰

**æ–°å¢æ–‡ä»¶**ï¼š
- âœ… `components/AnnotationTable.tsx` (250è¡Œ) - ç‹¬ç«‹è¡¨æ ¼ç»„ä»¶

**ä¿®æ”¹æ–‡ä»¶**ï¼š
- âœ… `components/Annotation.tsx` - ç§»é™¤æ—§è¡¨æ ¼å®ç°ï¼Œå¯¼å…¥æ–°ç»„ä»¶
- âœ… `parsers/ann-parser.ts` - æ–°å¢ `getTagById()` å·¥å…·å‡½æ•°

**æ–°å¢åŠŸèƒ½**ï¼š
- âœ… å†…è”å±æ€§ç¼–è¾‘ï¼š
  - list ç±»å‹ â†’ Select ä¸‹æ‹‰æ¡† + "-- EMPTY --" é€‰é¡¹
  - text ç±»å‹ â†’ Input è¾“å…¥æ¡†
  - idref ç±»å‹ â†’ Select ä¸‹æ‹‰æ¡†ï¼ˆæ˜¾ç¤ºå½“å‰æ–‡ä»¶æ‰€æœ‰å®ä½“ ID + Textï¼‰
- âœ… åˆ é™¤æŒ‰é’® + çº§è”åˆ é™¤ï¼š
  - æ— å…³è”å…³ç³» â†’ ç›´æ¥åˆ é™¤ + æç¤º
  - æœ‰å…³è”å…³ç³» â†’ Modal ç¡®è®¤å¯¹è¯æ¡† â†’ å…ˆåˆ é™¤ rtags â†’ å†åˆ é™¤ etag
- âœ… ç‚¹å‡»è¡Œé«˜äº®ï¼š
  - è¡¨æ ¼è¡Œè“è‰²é«˜äº®
  - ç¼–è¾‘å™¨ä¸­æ ‡æ³¨åŒæ­¥é«˜äº®ï¼ˆPhase 2 å·²å®ç°ï¼‰
- âœ… è‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨ï¼ˆæ–°æ ‡æ³¨åˆ›å»ºæ—¶ï¼‰

**å…³é”®æŠ€æœ¯è®¨è®º**ï¼š
- å…³ç³»å­˜å‚¨æœºåˆ¶ï¼šXML + ID å¼•ç”¨ï¼ˆé€šè¿‡å­—ç¬¦ä¸² ID å®ç°å…³ç³»ï¼Œæ— éœ€æ•°æ®åº“ï¼‰
- æ—¶é—´å¤æ‚åº¦ï¼šO(nÃ—m) å®Œå…¨å¤Ÿç”¨ï¼ˆå…¸å‹åœºæ™¯ 200 æ ‡æ³¨ < 1msï¼‰
- åå‘ç´¢å¼• vs åŒå‘å›¾ï¼šå½“å‰æ•°æ®è§„æ¨¡ä¸éœ€è¦ä¼˜åŒ–

**éªŒè¯**ï¼š
- âœ… TypeScript ç¼–è¯‘é›¶é”™è¯¯
- âœ… 75 ä¸ªæµ‹è¯•å…¨éƒ¨é€šè¿‡
- âœ… æµè§ˆå™¨æµ‹è¯•ï¼šå±æ€§ç¼–è¾‘ã€åˆ é™¤ã€é«˜äº®åŠŸèƒ½æ­£å¸¸

**ä¸‹ä¸€æ­¥**ï¼šPhase 5 å…³ç³»æ ‡æ³¨é“¾æ¥ï¼ˆæ¨è Opusï¼‰

---

### Session 4.5 â€” M4 Phase 5: å…³ç³»æ ‡æ³¨é“¾æ¥ (2026-02-17, Opus)

**æ–°å¢ç»„ä»¶**ï¼š
- `TagPopupMenu.tsx` (~210è¡Œ)ï¼šç‚¹å‡»å®ä½“æ ‡è®°å¼¹å‡ºèœå•ï¼ˆå…³ç³»ç±»å‹/é“¾æ¥IDREF/åˆ é™¤ï¼‰
- `LinkingBanner.tsx` (~170è¡Œ)ï¼šé“¾æ¥æ¨¡å¼å¯æ‹–æ‹½æµ®åŠ¨é¢æ¿ï¼ˆå±æ€§ç¼–è¾‘ + Done/Cancelï¼‰
- `AnnotationEditor.tsx` é‡å†™ï¼šé›†æˆä¸¤ä¸ªæ–°ç»„ä»¶ + å·¦é”®/å³é”®äº‹ä»¶åˆ†æµ

**Store ä¿®å¤**ï¼š
- `startLinking`/`setLinking`: ä¿®å¤æ¶ˆè´¹é€»è¾‘ï¼ŒIDREF å…¨å¡«åè‡ªåŠ¨å®Œæˆ
- `doneLinking`: æ”¹ç”¨ `getNextTagId()` æ›¿ä»£é‡å¤é€»è¾‘
- æ–°å¢ `updateLinkingAttr`: ä¾› banner ç¼–è¾‘å±æ€§

**Bug ä¿®å¤**ï¼š
- ID ç¢°æ’ï¼šå…±äº«å‰ç¼€çš„ä¸åŒ relation type ä¼šç”Ÿæˆé‡å¤ IDï¼ˆåŸç‰ˆä¹Ÿæœ‰æ­¤ bugï¼‰ï¼Œæ”¹ä¸ºæŒ‰å‰ç¼€æŸ¥é‡
- IDREF ä¸‹æ‹‰æ¡†è¯¯æ˜¾ç¤ºå…³ç³»æ ‡æ³¨ï¼ˆL0/L1ï¼‰ï¼šæ”¹ç”¨ DTD åˆ¤æ–­ etag
- IDREF ä¸‹æ‹‰æ¡†æ–‡æœ¬æˆªæ–­ï¼š`popupMatchSelectWidth={false}`
- è¡¨æ ¼è¡¨å¤´ sticky é‡å ï¼šåŠ  `zIndex: 1`

**éªŒè¯**ï¼š
- âœ… TypeScript ç¼–è¯‘é›¶é”™è¯¯
- âœ… 75 ä¸ªæµ‹è¯•å…¨éƒ¨é€šè¿‡
- âœ… æµè§ˆå™¨æµ‹è¯•ï¼šå®Œæ•´é“¾æ¥æµç¨‹ï¼ˆç‚¹å‡»å®ä½“â†’é€‰å…³ç³»â†’ç‚¹å‡»å®ä½“â†’è‡ªåŠ¨åˆ›å»ºï¼‰

**ä¸‹ä¸€æ­¥**ï¼šPhase 6 å…³ç³»è¿çº¿æ¸²æŸ“ï¼ˆæ¨è Sonnetï¼‰

---

### Session 4.6 â€” M4 Phase 6: å…³ç³»è¿çº¿æ¸²æŸ“ (2026-02-17, Opusâ†’Sonnet)

**æ–°å¢ç»„ä»¶**ï¼š
- `RelationLines.tsx` (~270è¡Œ)ï¼šSVG è¿çº¿è¦†ç›–å±‚ï¼Œç»˜åˆ¶å®ä½“é—´å…³ç³»æŠ˜çº¿

**æ ¸å¿ƒç®—æ³•**ï¼š
- `view.coordsAtPos()` è·å–å®ä½“åæ ‡ â†’ å®¹å™¨ç›¸å¯¹åæ ‡
- 4ç‚¹æŠ˜çº¿ï¼šAé¡¶éƒ¨ â†’ Aä¸Šæ–¹(6px) â†’ Bä¸Šæ–¹ â†’ Bé¡¶éƒ¨
- å½©è‰²æ ‡ç­¾ï¼š`.svgmark-tag-{TAG}` åŠ¨æ€ CSSï¼ˆå…³ç³»ç±»å‹é¢œè‰²ï¼‰
- å“åº”å¼ï¼šç›‘å¬æ»šåŠ¨/resize/æ•°æ®å˜åŒ–è‡ªåŠ¨é‡ç®—

**å·¥å…·æ å¼€å…³**ï¼š
- Show Links / Show Lines / Show Link Nameï¼ˆ`Annotation.tsx`ï¼‰

**æ–‡ä»¶åˆ—è¡¨å¢å¼º**ï¼š
- æ˜¾ç¤ºæ–‡ä»¶æ•° / tag æ•°
- åˆ é™¤å•ä¸ªæ–‡ä»¶ï¼ˆå‡å·å›¾æ ‡ï¼‰+ åˆ é™¤å…¨éƒ¨ï¼ˆçº¢è‰²åƒåœ¾æ¡¶ï¼‰
- unsaved æ ‡è®°ï¼ˆçº¢è‰² `*` å·ï¼‰

**æ ·å¼è°ƒæ•´**ï¼š
- `.cm-gutters` åŠ  `lineHeight: '2em'` å¯¹é½è¡Œå·
- è¿çº¿ `deltaHeight=6px`ï¼Œæ ‡ç­¾ 8px å­—ä½“

**è°ƒè¯•é—®é¢˜**ï¼š
- è¿çº¿ä½ç½®é”™è¯¯ â†’ åæ ‡ç³»è½¬æ¢ä¿®å¤
- åŠ è½½æ—¶æ— è¿çº¿ â†’ RAF å»¶è¿Ÿä¸€å¸§
- æ ‡ç­¾è¢«è£æ‰ â†’ è°ƒæ•´ deltaHeight
- æ ‡ç­¾ç™½è‰² â†’ æ”¹ç”¨å…³ç³»ç±»å‹é¢œè‰²

**éªŒè¯**ï¼š
- âœ… TypeScript ç¼–è¯‘é›¶é”™è¯¯
- âœ… 75 æµ‹è¯•é€šè¿‡
- âœ… æµè§ˆå™¨æµ‹è¯•ï¼šè¿çº¿æ­£ç¡®æ˜¾ç¤ºï¼Œå·¥å…·æ å¼€å…³æ­£å¸¸

---

### 2026-02-17 - Session 4.7 M4 Phase 7: ä¿å­˜ + å¿«æ·é”® + æœç´¢

**æäº¤**: fc65c8b

- âœ… Save XML æŒ‰é’® + Ctrl+S ä¿å­˜
- âœ… å¿«æ·é”®å®ä½“åˆ›å»ºï¼ˆ1-9, a, c, v, b â†’ etagsï¼‰
- âœ… CM6 æœç´¢é¢æ¿ï¼ˆCtrl+Fï¼‰

---

### 2026-02-18 - Session 4.8 M4 Phase 8/9/10: Hint + Sentence + ä¿®å¤

**Phase 8 â€” Hint ç³»ç»Ÿ**ï¼š
- âœ… Store: hintDict + acceptHint/acceptAllHints
- âœ… CM6 è£…é¥°å±‚: hint è™šçº¿ä¸‹åˆ’çº¿ + id_prefix æ ‡ç­¾ï¼ˆå¦‚ "S"ï¼‰
- âœ… ç‚¹å‡» hint è‡ªåŠ¨æ¥å— + "Accept All" æŒ‰é’®
- âœ… æ–‡ä»¶åŠ è½½åè‡ªåŠ¨æ„å»º hint å­—å…¸

**Phase 9 â€” Sentence åˆ†å¥æ¨¡å¼**ï¼š
- âœ… æ–°å»º `utils/nlp-toolkit.ts`: sentTokenize (simpledot_v2) + åŒå‘åç§»æ˜ å°„
- âœ… ç¼–è¾‘å™¨: sentences æ¨¡å¼æ˜¾ç¤º + tag/hint span é‡æ˜ å°„ + åå‘æ˜ å°„åˆ›å»ºæ ‡æ³¨
- âœ… RelationLines: sentence æ¨¡å¼è¿çº¿é‡æ˜ å°„

**Phase 10 â€” å°ä¿®å¤**ï¼š
- âœ… RelationLines: displayTagName è¿‡æ»¤è¿çº¿
- âœ… Annotation: åŠ è½½è¿›åº¦ Spin

**æµ‹è¯•ç²¾ç®€**ï¼š
- ğŸ”§ 104 ä¸ªæµ‹è¯• â†’ 21 ä¸ªï¼ˆç æ‰çç¢ç”¨ä¾‹ï¼Œåªä¿ç•™æ ¸å¿ƒè·¯å¾„ + roundtripï¼‰

**éªŒè¯**ï¼š
- âœ… ç¼–è¯‘é›¶é”™è¯¯ï¼Œ21 æµ‹è¯•é€šè¿‡
- âœ… æµè§ˆå™¨: hint/sentence/è¿çº¿è¿‡æ»¤ å…¨éƒ¨æ­£å¸¸

**M4 æ ‡æ³¨ç¼–è¾‘å™¨ â€” å…¨éƒ¨ 10 ä¸ª Phase å®Œæˆ** ğŸ‰

**ä¸‹ä¸€æ­¥**ï¼šM5 Schema ç¼–è¾‘å™¨ æˆ– M6 å…¶ä»–åŠŸèƒ½ Tab

---

### 2026-02-19 - Session 5.1 M5: Schema Editor

**æ¨¡å‹**: Sonnet 4.5 â†’ Opus 4.6

**Store æ‰©å±•** (`store.ts`):
- âœ… æ–°å¢: `seDtd`, `seOpen` çŠ¶æ€
- âœ… æ–°å¢ actions: `openSchemaEditorNew`, `openSchemaEditorCopy`, `openSchemaEditorLoad`, `closeSchemaEditor`, `setSeDtd`

**æ–°å¢ç»„ä»¶**ï¼š
- âœ… `components/SchemaEditor.tsx` (~290è¡Œ)ï¼šAnt Design Modal (1020px, zIndex=2000)
  - æ°´å¹³å·¥å…·æ  (sticky): Schema Name / New / Open / Sample+Load / Use / Download(YAML|JSON|DTD)
  - ä¸¤åŒºå—: Entity Tags + Relation Tagsï¼Œæ¯ä¸ª tag æ°´å¹³ TagRow å¸ƒå±€
  - Tag CRUD: æ·»åŠ /åˆ é™¤ tagï¼Œåç§°éªŒè¯ `[A-Za-z0-9_]`
  - Attr CRUD: æ·»åŠ /åˆ é™¤å±æ€§ï¼Œtext/list/idref ä¸‰ç§ç±»å‹
  - LIST DEFAULT: Select ä¸‹æ‹‰æ¡† (ä» att.values å¡«å……ï¼Œ`popupMatchSelectWidth={false}`)
  - is_non_consuming åˆ‡æ¢: "SPAN" / "DOCUMENT + SPAN"
  - Sample DTD: Vite `?raw` å¯¼å…¥ 4 ä¸ª sample æ–‡ä»¶
  - "Use": `extendBaseDtd â†’ assignTagColors â†’ assignTagShortcuts â†’ injectTagColors â†’ setDtd â†’ clearAnns`

**ä¿®æ”¹æ–‡ä»¶**ï¼š
- âœ… `Annotation.tsx`: æ·»åŠ  Schema Editor å›¾æ ‡æŒ‰é’® (ToolOutlined) + æ¸²æŸ“ `<SchemaEditor />`
- âœ… `utils/tag-helper.ts`: å¯¼å‡º `APP_SHORTCUTS` + `assignTagShortcuts`ï¼ˆä» Annotation.tsx æå–ï¼‰
- âœ… `RelationLines.tsx`: ç§»é™¤ `enabledLinkComplex` å¼•ç”¨ï¼ˆ"Show Lines" å¼€å…³å·²åˆ é™¤ï¼‰

**UI è¿­ä»£ï¼ˆå¤šè½®ä¿®å¤ï¼‰**ï¼š
- ğŸ› ä¸¤åˆ—å¸ƒå±€ â†’ æ”¹ä¸ºæ°´å¹³ TagRowï¼ˆå¯¹é½åŸç‰ˆï¼‰
- ğŸ› æŒ‰é’®å¯¼è‡´å·¥å…·æ è¿‡é«˜ â†’ æ”¹ä¸º icon-only æŒ‰é’®
- ğŸ› LIST DEFAULT æ— é¢„é€‰é¡¹ â†’ æ”¹ä¸º Select ä¸‹æ‹‰æ¡†
- ğŸ› ä¸‹æ‹‰æ¡†æˆªæ–­ â†’ `popupMatchSelectWidth={false}`
- ğŸ› Modal z-index â†’ `zIndex={2000}`
- ğŸ› å·¥å…·æ éšæ»šåŠ¨æ¶ˆå¤± â†’ `position: sticky`
- ğŸ› sticky é¡¶éƒ¨æœ‰ç©ºéš™ â†’ `top: -8px, marginTop: -8px, paddingTop: 8px`ï¼ˆè¡¥å¿ Modal body paddingï¼‰

**éªŒè¯**ï¼š
- âœ… ç¼–è¯‘é›¶é”™è¯¯ï¼Œ21 æµ‹è¯•é€šè¿‡
- âœ… æµè§ˆå™¨: æ‰“å¼€/ç¼–è¾‘/åŠ è½½ sample/Use/Download å…¨éƒ¨æ­£å¸¸

**M5 Schema Editor â€” å®Œæˆ** ğŸ‰

**ä¸‹ä¸€æ­¥**ï¼šM6 å…¶ä»–åŠŸèƒ½ Tab

---

---

### 2026-02-19 - Session 6.1 M6 Phase 1-3: Statistics + Export + Converter

**Phase 1 â€” Statistics Tab** (5c31721):
- âœ… é‡å†™ `Statistics.tsx`ï¼šè¯­æ–™åº“ç»Ÿè®¡ï¼ˆæ–‡ä»¶æ•°ã€tag åˆ†å¸ƒï¼‰

**Phase 2 â€” Export Tab** (e2a4f90):
- âœ… é‡å†™ `Export.tsx`ï¼šæ”¯æŒ XML/BioC/JSON/CSV å¯¼å‡º + ZIP æ‰¹é‡ä¸‹è½½

**Phase 3 â€” Converter Tab** (8f8f49e):
- âœ… é‡å†™ `Converter.tsx`ï¼šRaw Textâ†’XML + MedTaggerâ†’XML è½¬æ¢

---

### 2026-02-19 - Session 6.2 M6 Phase 4: Adjudication/IAA

**æäº¤**: c369b98ï¼ˆOpus 4.6ï¼‰

**æ–°å¢æ–‡ä»¶**ï¼š
- âœ… `utils/iaa-calculator.ts` (~650è¡Œ)ï¼šIAA è®¡ç®—å¼•æ“
  - æ–‡æ¡£å“ˆå¸ŒåŒ¹é…ã€Tag overlap/exact åŒ¹é…ã€F1/Cohen's Kappa + 95% CI
  - Gold Standard è£å†³ã€5 ä¸ª Excel æŠ¥å‘Š sheet
- âœ… `components/Adjudication.tsx` (~846è¡Œ)ï¼šå®Œæ•´ IAA UI
  - A/B Dropzone + Calculate + F1 Score é¢æ¿ + Cohen's Kappa æ··æ·†çŸ©é˜µ
  - Tag è¯¦æƒ…ï¼ˆaccept/reject è£å†³ï¼‰+ ZIP/Excel å¯¼å‡º

**Bug ä¿®å¤**ï¼š
- ğŸ› `evaluateAnnOnDtd` å´©æºƒï¼š`result.all` èµ‹å€¼é¡ºåºé”™è¯¯ â†’ ç§»åˆ° `getCohenKappaOverall` è°ƒç”¨å‰
- ğŸ› xlsx æ—  default export â†’ `import * as XLSX`
- ğŸ› calculate æ— é”™è¯¯å¤„ç† â†’ åŠ  try-catch + message.error

**éªŒè¯**ï¼šç¼–è¯‘é›¶é”™è¯¯ï¼Œ21 æµ‹è¯•é€šè¿‡ï¼ŒF1=0.8571 / Kappa=0.6667

---

### 2026-02-19 - Session 6.3 M6 Phase 5: Toolkit + ç§»é™¤ Error Analysis

**æäº¤**: 845e9d4

- âœ… åˆ é™¤ `ErrorAnalysis.tsx`ï¼ˆç”¨æˆ·å†³å®šä¸éœ€è¦ï¼‰
- âœ… æ–°å¢ `Toolkit.tsx` (~270è¡Œ)ï¼šMedTaggerVis å¯è§†åŒ–
  - ä¸‰åˆ—å¸ƒå±€ï¼š.txt æ–‡ä»¶ | .ann æ–‡ä»¶ | é«˜äº®å¯è§†åŒ–
  - æ‹–æ‹½åŠ è½½ + ç‚¹å‡» .ann è‡ªåŠ¨åŒ¹é… .txt â†’ æ¸²æŸ“å®ä½“é«˜äº®
  - Certainty/Status å±æ€§ glyph æ˜¾ç¤º
- âœ… `brat-parser.ts` æ–°å¢ `parseMedTaggerAnn()` è§£æå™¨

**éªŒè¯**ï¼šç¼–è¯‘é›¶é”™è¯¯ï¼Œ21 æµ‹è¯•é€šè¿‡

**M6 å…¨éƒ¨ 5 ä¸ª Phase å®Œæˆ** ğŸ‰

---

### 2026-02-20 - Session 7.1 M7: LLM è‡ªåŠ¨æ ‡æ³¨ (Ollama)

**æ¨¡å‹**: Opus 4.6

**æ–°å¢æ–‡ä»¶**ï¼š
- âœ… `utils/ollama-client.ts` (~90è¡Œ)ï¼šOllama REST API å°è£…
  - `checkOllamaStatus` / `listModels` / `requestAutoAnnotation`
  - POST `/api/chat`ï¼ˆstream:false, format:jsonï¼‰ï¼Œprompt è®¾è®¡ï¼šå…³é”®è¯+æ ‡ç­¾åˆ†ç±»
- âœ… `utils/auto-annotate.ts` (~70è¡Œ)ï¼šLLM è¾“å‡º â†’ AnnTag è½¬æ¢
  - `getLocs()` æ­£åˆ™åŒ¹é…ç²¾ç¡® spanï¼ˆä¸ä¿¡ä»» LLM çš„åç§»é‡ï¼‰
  - é‡å æ£€æµ‹ï¼šè·³è¿‡ä¸å·²æœ‰æ ‡æ³¨é‡å çš„ä½ç½®

**ä¿®æ”¹æ–‡ä»¶**ï¼š
- âœ… `store.ts` (+25è¡Œ)ï¼š`ollamaConfig` + `isAutoAnnotating` çŠ¶æ€ + `autoAnnotate()` action
- âœ… `Annotation.tsx` (+60è¡Œ)ï¼šå·¥å…·æ  "Auto-Annotate (LLM)" åˆ†ç»„ + Settings Modal

**æ ¸å¿ƒè®¾è®¡**ï¼šLLM åªè¿”å› `{keyword, tag}`ï¼Œspan å®šä½äº¤ç»™ `getLocs()` æ­£åˆ™åŒ¹é…
```
LLM: "headache" â†’ SYMPTOM â†’ getLocs("headache", text) â†’ [[23,31]] â†’ makeEtag()
```

**éªŒè¯**ï¼šç¼–è¯‘é›¶é”™è¯¯ï¼Œ21 æµ‹è¯•é€šè¿‡ï¼Œæµè§ˆå™¨åŠŸèƒ½æ­£å¸¸

---

### 2026-02-25 - Session 7.2 M7 æ”¹è¿›ï¼šå¦å®šæ£€æµ‹ + getLocs é²æ£’æ€§

**é—®é¢˜**ï¼šmistral/deepseek å®æµ‹å‘ç°å¤šç©ºæ ¼ä¸åŒ¹é…ã€å¦å®šè¯­å¢ƒè¯¯æ ‡æ³¨ã€JSON è§£æå¤±è´¥

**æ”¹åŠ¨**ï¼š
- âœ… `getLocs`ï¼šç‰¹æ®Šå­—ç¬¦è½¬ä¹‰ + ç©ºæ ¼ â†’ `\s+`ï¼ˆ`"blood pressure"` åŒ¹é… `"blood  pressure"`ï¼‰
- âœ… `isNegatedByContext`ï¼šåŒå‘çª—å£å¦å®šæ£€æµ‹
  - å‰å‘ 60 å­—ç¬¦ï¼š`denies/no /doesn't/negative for...`ï¼Œå¥å·/è½¬æŠ˜è¯æˆªæ–­
  - åå‘ 30 å­—ç¬¦ï¼š`absent/not found/: none...`ï¼ˆå¤„ç† `"Fever: absent"` åç½®å¦å®šï¼‰
- âœ… `ollama-client`ï¼šJSON è§£æå‰å‰¥ markdown ä»£ç å—ï¼ˆdeepseek ä¹ æƒ¯åŒ…è£¹è¾“å‡ºï¼‰
- âœ… Promptï¼š`ONLY use these exact tag names: ${tagList}`ï¼ˆé˜²æ­¢æ¨¡å‹ç”¨ DISORDER ä»£æ›¿ DISEASEï¼‰
- âœ… æµ‹è¯•ï¼š27 â†’ 45 ä¸ª

**è°ƒè¯•è¿‡ç¨‹ä¸­è¸©çš„å‘**ï¼š

| é—®é¢˜ | åŸå›  | ä¿®å¤ |
|------|------|------|
| `chest pain` å¦å®šæœªè¿‡æ»¤ | mistral æ²¡è¯†åˆ« "denies" | åŠ å®¢æˆ·ç«¯å‰å‘çª—å£ |
| `nausea` è¢«è¯¯æ€ | è·¨å¥ï¼Œ"doesn't" åœ¨ 60 å­—ç¬¦çª—å£å†… | å¥å·åŠ å…¥ scope breaker |
| deepseek JSON è§£æå¤±è´¥ | è¾“å‡ºåŒ… markdown ä»£ç å— | strip ` ```json ``` ` |
| `hypertension` æœªæ ‡æ³¨ | æ¨¡å‹ç”¨ "DISORDER" ä¸åœ¨ DTD é‡Œ | Prompt é‡å¤å¼ºè°ƒ tag åˆ—è¡¨ |
| mistral è¾“å‡ºä¸ç¨³å®š | temperature=0.8 æœ‰éšæœºæ€§ | å¾…åŠ  `temperature: 0` |

**å­¦åˆ°çš„**ï¼š
LLM å·¥ç¨‹
  - LLM è¾“å‡ºä¸å¯é ï¼Œä¸èƒ½ä¿¡ä»»å®ƒçš„ span åç§»ï¼Œåªç”¨ keyword+tag å†å®¢æˆ·ç«¯å®šä½
  - å°æ¨¡å‹ï¼ˆmistral 4GBï¼‰åœ¨ç»“æ„åŒ–è¾“å‡ºä¸Šä¸ç¨³å®šï¼Œtemperature å½±å“å¯é‡å¤æ€§
  - ä¸åŒæ¨¡å‹å¯¹ format: 'json' éµå®ˆç¨‹åº¦ä¸åŒï¼ˆdeepseek ä¼šåŠ  markdown åŒ…è£¹ï¼‰
  - Prompt å·¥ç¨‹ï¼šåŒä¸€æ¡è§„åˆ™è¯´ä¸€éä¸å¤Ÿï¼Œå…³é”®çº¦æŸè¦é‡å¤ã€å…·ä½“ï¼ˆtag åˆ—è¡¨åœ¨ Rules é‡Œå†åˆ—ä¸€æ¬¡ï¼‰

  NLP / å¦å®šæ£€æµ‹
  - NegEx ç®—æ³•çš„æ ¸å¿ƒæ€æƒ³ï¼šç”¨æ»‘åŠ¨çª—å£æŸ¥å¦å®šè¯ï¼Œç”¨ scope breaker æˆªæ–­ä½œç”¨åŸŸ
  - å‰ç½®å¦å®šï¼ˆdenies Xï¼‰vs åç½®å¦å®šï¼ˆX: absentï¼‰éœ€è¦åˆ†åˆ«å¤„ç†
  - sentence boundary æ¯” "but" è¿™ç±»è¯æ›´å¼ºçš„ scope breaker
  - ç®€åŒ–ç‰ˆ NegEx çš„è¾¹ç•Œï¼šå¤æ‚åµŒå¥—ä»å¥ï¼ˆä¾å­˜å¥æ³•æ ‘æ‰èƒ½è§£å†³ï¼‰

  ç®—æ³•
  - Two-Way å­—ç¬¦ä¸²åŒ¹é…ï¼šO(n) æ—¶é—´ + O(1) ç©ºé—´ï¼Œæ¯” KMP ç©ºé—´æ›´ä¼˜
  - \b çš„å±€é™æ€§ï¼šå¯¹éå•è¯å­—ç¬¦è¾¹ç•Œä¸èµ·ä½œç”¨
  - å¤šä¹‰è¯é—®é¢˜ï¼ˆåŒè¯å‡ºç°ä¸¤æ¬¡ï¼‰ï¼šå·¥ç¨‹ä¸Šæ¥å—å‡é˜³æ€§æ¯”æ¼æ ‡æ›´å¥½å¤„ç†

  æµ‹è¯•é©±åŠ¨
  - å…ˆç”¨çœŸå®æ¨¡å‹è·‘ï¼Œå‘ç°é—®é¢˜åå†å†™å•å…ƒæµ‹è¯•å›ºåŒ– fix
  - è°ƒè¯• console.log â†’ ç¡®è®¤ raw response â†’ å®šä½æ ¹å›  â†’ ä¿®å¤ â†’ åˆ  log çš„æµç¨‹

**æäº¤**ï¼šc96d8b0

---

### é¡¹ç›®æ€»è¿›åº¦

| æ¨¡å— | çŠ¶æ€ | æäº¤ |
|------|------|------|
| M1 é¡¹ç›®æ­å»º | âœ… å®Œæˆ | e9c5464 |
| M2 è§£æå™¨ç§»æ¤ | âœ… å®Œæˆ | å¤šæ¬¡æäº¤ |
| M3 çŠ¶æ€+æ–‡ä»¶ | âœ… å®Œæˆ | å¤šæ¬¡æäº¤ |
| M4 æ ‡æ³¨ç¼–è¾‘å™¨ (10 Phase) | âœ… å®Œæˆ | 8abb46a â†’ 89b25a5 |
| M5 Schema Editor | âœ… å®Œæˆ | 0ac5eb2 |
| M6 åŠŸèƒ½ Tab (5 Phase) | âœ… å®Œæˆ | 5c31721 â†’ 845e9d4 |
| M7 LLM è‡ªåŠ¨æ ‡æ³¨ | âœ… å®Œæˆ | å¾…æäº¤ |
| M8 Electron æ‰“åŒ… | â¸ å¾…å¼€å§‹ | |
| M9 è”è°ƒä¿® bug | â¸ å¾…å¼€å§‹ | |

**ä¸‹ä¸€æ­¥**ï¼šM8 Electron æ¡Œé¢æ‰“åŒ… æˆ– M9 è”è°ƒä¿® bug

---

### 2026-02-26 - Session 7.3 M7 æ”¹è¿›ï¼šTag Description + LLM Pipeline å¯¹é½

**èƒŒæ™¯**ï¼šé‡åŒ–å®éªŒï¼ˆeval_llm.pyï¼‰æ˜¾ç¤ºï¼Œç»™æ¯ä¸ª tag é™„æè¿°å Recall ä» 0.27 â†’ 0.77ï¼Œä½†ç”Ÿäº§ä»£ç åªä¼  tag åç§°ã€‚

**æ”¹åŠ¨ï¼ˆ6 ä¸ªæ–‡ä»¶ï¼‰**ï¼š

- âœ… `types.ts`ï¼š`DtdTag` æ·»åŠ  `description?: string` å­—æ®µ
- âœ… `dtd-parser.ts`ï¼š`parseTmpDtd` etag/rtag å¾ªç¯é‡Œè¯»å– descriptionï¼›`minimizeDtdJson` æ— éœ€æ”¹åŠ¨ï¼ˆä¸ä¸»åŠ¨åˆ é™¤è¯¥å­—æ®µï¼Œè‡ªåŠ¨ä¿ç•™ï¼‰
- âœ… `SchemaEditor.tsx`ï¼š
  - TagRow é‡æ–°è®¾è®¡ï¼šdescription ä»å·¦ä¾§çª„åˆ—ç§»é™¤ï¼Œæ”¹ä¸º **å…¨å®½ LLM HINT åº•æ **ï¼ˆæœ‰å†…å®¹æ—¶è“è‰²æ ‡ç­¾+æµ…è“èƒŒæ™¯ï¼Œç©ºæ—¶ç°è‰²æ·¡åŒ–ï¼‰
  - `destroyOnClose` â†’ `destroyOnHidden`ï¼ˆAnt Design åºŸå¼ƒè­¦å‘Šä¿®å¤ï¼‰
  - `handleUse` ç§»é™¤ `clearAnns()` å’Œç¡®è®¤å¯¹è¯æ¡†ï¼ˆç‚¹ Use ä¸å†æ¸…ç©ºå·²åŠ è½½çš„ XML æ–‡ä»¶ï¼‰
- âœ… `ollama-client.ts`ï¼š
  - ç­¾å `etagNames: string[]` â†’ `etags: Array<{name, description?}>`
  - Prompt `Entity tags:` å±•å¼€ä¸ºå¤šè¡Œ `- TagName: description`
  - æ–°å¢ `options: { temperature: 0 }`ï¼ˆä¸é‡åŒ–å®éªŒå¯¹é½ï¼Œä¿è¯å¯é‡å¤æ€§ï¼‰
  - æ–°å¢è°ƒè¯• `console.log('[LLM prompt] tags:')` + `'[LLM prompt] user prompt:'`
- âœ… `store.ts`ï¼š`autoAnnotate` ä¼  `{name, description}` å¯¹è±¡æ•°ç»„
- âœ… `auto-annotate.ts`ï¼šæ–°å¢ `getSpanFromTag` + `hasSameTagOverlap` åŒ tag dedup

**ä¸é‡åŒ–å®éªŒçš„å‰©ä½™å·®å¼‚**ï¼ˆå½±å“æå°ï¼Œæš‚ä¸å¤„ç†ï¼‰ï¼š
- Prompt æ ‡ç­¾æªè¾ï¼šå®éªŒç”¨ `Tag definitions:`ï¼Œç”Ÿäº§ç”¨ `Entity tags:`
- Dedup é¡ºåºï¼šå®éªŒå…ˆå…¨éƒ¨æ”¶é›†â†’æŒ‰ start æ’åºâ†’å»é‡ï¼›ç”Ÿäº§é€ keyword è¾¹å¤„ç†è¾¹å»é‡

**éªŒè¯**ï¼šç¼–è¯‘é›¶é”™è¯¯ï¼Œ45 ä¸ªæµ‹è¯•å…¨éƒ¨é€šè¿‡

*æœ€åæ›´æ–°: 2026-02-26*